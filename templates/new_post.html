{% extends "base.html" %} {% block title %}New Post - My Blog{% endblock %} {%
block content %}
<div class="form-container">
  <h2>Create New Post</h2>

  <form method="POST" action="/blog/new" class="post-form" enctype="multipart/form-data">
    <div class="form-group">
      <label for="title">Title *</label>
      <input type="text" id="title" name="title" required />
    </div>

    <div class="form-group">
      <label for="content">Content *</label>
      <textarea id="content" name="content" rows="12" required></textarea>
    </div>

    <div class="form-group">
      <label for="excerpt">Excerpt *</label>
      <textarea
        id="excerpt"
        name="excerpt"
        rows="3"
        required
        placeholder="Short preview of your post (first 150 characters)"
      ></textarea>
    </div>

    <div class="form-group">
      <label for="tags">Tags</label>
      <input
        type="text"
        id="tags"
        name="tags"
        placeholder="python, flask, learning"
      />
      <small>Separate tags with commas</small>

      {% if existing_tags %}
      <div class="existing-tags">
        <small><strong>Existing tags:</strong></small>
        <div class="tag-suggestions">
          {% for tag in existing_tags %}
          <span class="tag-suggestion" onclick="addTag('{{ tag }}')"
            >{{ tag }}</span
          >
          {% endfor %}
        </div>
      </div>
      {% endif %}
    </div>

    <div class="form-group">
      <label>Image (optional)</label>
      <div class="image-upload-options">
        <div class="upload-option">
          <input type="radio" id="upload-file" name="image_option" value="file" checked onchange="toggleImageInput()">
          <label for="upload-file">Upload Image</label>
        </div>
        <div class="upload-option">
          <input type="radio" id="upload-url" name="image_option" value="url" onchange="toggleImageInput()">
          <label for="upload-url">Image URL</label>
        </div>
      </div>

      <input
        type="file"
        id="image_file"
        name="image_file"
        accept="image/*"
        style="margin-top: 0.5rem;"
      />
      <input
        type="text"
        id="image_url"
        name="image_url"
        placeholder="https://example.com/image.jpg"
        style="margin-top: 0.5rem; display: none;"
      />
      <small>Upload an image or provide a URL</small>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">Publish Post</button>
      <a href="/blog" class="btn-secondary">Cancel</a>
    </div>
  </form>
</div>

<script>
  function addTag(tag) {
    const tagsInput = document.getElementById("tags");
    const currentTags = tagsInput.value;

    // If input is empty, just add the tag
    if (currentTags.trim() === "") {
      tagsInput.value = tag;
    } else {
      // Add comma and tag
      tagsInput.value = currentTags + ", " + tag;
    }

    // Focus back on input
    tagsInput.focus();
  }

  function toggleImageInput() {
    const fileInput = document.getElementById("image_file");
    const urlInput = document.getElementById("image_url");
    const selectedOption = document.querySelector('input[name="image_option"]:checked').value;

    if (selectedOption === "file") {
      fileInput.style.display = "block";
      urlInput.style.display = "none";
      urlInput.value = "";
    } else {
      fileInput.style.display = "none";
      urlInput.style.display = "block";
      fileInput.value = "";
    }
  }
</script>
{% endblock %}
